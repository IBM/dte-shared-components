Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};exports.setSuggestionsSearchValue=setSuggestionsSearchValue;exports.clearSuggestionsSearchValue=clearSuggestionsSearchValue;exports.updateAnalyticsConfig=updateAnalyticsConfig;exports.recordResultClick=recordResultClick;exports.recordSuggestionClick=recordSuggestionClick;exports.recordImpressions=recordImpressions;var _constants=require('../constants');function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function setSuggestionsSearchValue(value){return{type:_constants.SET_SUGGESTIONS_SEARCH_VALUE,value:value};}function clearSuggestionsSearchValue(){return{type:_constants.CLEAR_SUGGESTIONS_SEARCH_VALUE};}function updateAnalyticsConfig(analyticsConfig){return{type:_constants.UPDATE_ANALYTICS_CONFIG,analyticsConfig:analyticsConfig};}function recordClick(_ref){var url=_ref.url,app=_ref.app,credentials=_ref.credentials,headers=_ref.headers,documentId=_ref.documentId,clickPosition=_ref.clickPosition,queryId=_ref.queryId,clickType=_ref.clickType;if(!documentId){console.warn('ReactiveSearch: document id is required to record the click analytics');}else{fetch(url+'/'+app+'/_analytics/click',{method:'PUT',body:JSON.stringify({query_id:queryId,click_type:clickType||'result',click_on:_defineProperty({},documentId,clickPosition+1)}),headers:_extends({},headers,{'Content-Type':'application/json',Authorization:'Basic '+btoa(credentials)})});}}function recordResultClick(searchPosition,documentId){return function(dispatch,getState){var _getState=getState(),config=_getState.config,searchId=_getState.analytics.searchId,headers=_getState.headers,_getState$appbaseRef=_getState.appbaseRef,url=_getState$appbaseRef.url,protocol=_getState$appbaseRef.protocol,credentials=_getState$appbaseRef.credentials;var app=config.app;var esURL=protocol+'://'+url;if(config.analytics&&searchId){var parsedHeaders=headers;delete parsedHeaders['X-Search-Query'];var parsedURL=(esURL||'').replace(/\/+$/,'');if(parsedURL.includes('scalr.api.appbase.io')){fetch(parsedURL+'/'+app+'/_analytics',{method:'POST',headers:_extends({},parsedHeaders,{'Content-Type':'application/json',Authorization:'Basic '+btoa(credentials),'X-Search-Id':searchId,'X-Search-Click':true,'X-Search-ClickPosition':searchPosition+1})});}else{recordClick({url:parsedURL,app:app,credentials:credentials,parsedHeaders:parsedHeaders,documentId:documentId,clickPosition:searchPosition,queryId:searchId});}}};}function recordSuggestionClick(searchPosition,documentId){return function(dispatch,getState){var _getState2=getState(),config=_getState2.config,suggestionsSearchId=_getState2.analytics.suggestionsSearchId,headers=_getState2.headers,_getState2$appbaseRef=_getState2.appbaseRef,url=_getState2$appbaseRef.url,protocol=_getState2$appbaseRef.protocol,credentials=_getState2$appbaseRef.credentials;var app=config.app;var esURL=protocol+'://'+url;if(config.analytics&&(config.analyticsConfig===undefined||config.analyticsConfig.suggestionAnalytics===undefined||config.analyticsConfig.suggestionAnalytics)&&suggestionsSearchId&&searchPosition!==undefined){var parsedHeaders=headers;delete parsedHeaders['X-Search-Query'];var parsedURL=(esURL||'').replace(/\/+$/,'');if(parsedURL.includes('scalr.api.appbase.io')){fetch(parsedURL+'/'+app+'/_analytics',{method:'POST',headers:_extends({},parsedHeaders,{'Content-Type':'application/json',Authorization:'Basic '+btoa(credentials),'X-Search-Id':suggestionsSearchId,'X-Search-Suggestions-Click':true,'X-Search-Suggestions-ClickPosition':searchPosition+1})});}else{recordClick({url:parsedURL,app:app,credentials:credentials,parsedHeaders:parsedHeaders,documentId:documentId,clickPosition:searchPosition,clickType:'suggestion',queryId:suggestionsSearchId});}}};}function recordImpressions(queryId){var impressions=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return function(dispatch,getState){var _getState3=getState(),app=_getState3.config.app,headers=_getState3.headers,_getState3$appbaseRef=_getState3.appbaseRef,url=_getState3$appbaseRef.url,protocol=_getState3$appbaseRef.protocol,credentials=_getState3$appbaseRef.credentials;var esURL=protocol+'://'+url;var parsedURL=esURL.replace(/\/+$/,'');if(!parsedURL.includes('scalr.api.appbase.io')&&queryId&&impressions.length){fetch(parsedURL+'/'+app+'/_analytics/search',{method:'PUT',body:JSON.stringify({query_id:queryId,impressions:impressions}),keepalive:true,headers:_extends({},headers,{'Content-Type':'application/json',Authorization:'Basic '+btoa(credentials)})});}};}